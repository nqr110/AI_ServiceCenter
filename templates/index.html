<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>金华市立体地图 | Jinhua 3D Map</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts-gl@2.0.9/dist/echarts-gl.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  </head>
  <body>
    <!-- 加载动画 -->
    <div id="loading-screen">
      <div class="loading-container">
        <div class="loading-logo">
          <div class="hologram-sphere"></div>
          <div class="loading-text">系统启动中...</div>
        </div>
        <div class="loading-progress">
          <div class="progress-bar">
            <div class="progress-fill"></div>
          </div>
          <div class="progress-text">0%</div>
        </div>
        <div class="loading-steps">
          <div class="step" data-step="1">初始化系统...</div>
          <div class="step" data-step="2">加载地图数据...</div>
          <div class="step" data-step="3">渲染3D场景...</div>
          <div class="step" data-step="4">启动完成</div>
        </div>
      </div>
    </div>

    <!-- 主要内容区域 -->
    <div id="main-content" style="display: none">
      <!-- 标题区域 -->
      <div class="header">
        <h1 class="main-title">软通动力 综合管理系统</h1>
        <h2 class="sub-title">-------</h2>
      </div>

      <!-- 左侧容器 -->
      <div class="left-panel">
        <div class="panel-container">
          <div class="panel-item" id="left-panel-1">
            <h3>区块统计</h3>
            <div class="panel-content">
              <div class="stats-container">
                <div class="stats-text">
                  <div class="stat-item">
                    <span class="stat-label">总区块数</span>
                    <span class="stat-value" id="total-blocks">106</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">正常区块</span>
                    <span class="stat-value" id="normal-blocks">95</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">警告区块</span>
                    <span class="stat-value" id="warning-blocks">11</span>
                  </div>
                </div>
                <div class="stats-chart">
                  <div id="stats-pie-chart" style="width: 150px; height: 150px;"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="panel-item" id="left-panel-2">
            <h3>系统状态</h3>
            <div class="panel-content">
              <div class="status-item">
                <span class="status-label">地图服务</span>
                <span class="status-value online">在线</span>
              </div>
              <div class="status-item">
                <span class="status-label">数据更新</span>
                <span class="status-value online">实时</span>
              </div>
            </div>
          </div>
          <div class="panel-item" id="left-panel-3">
            <h3>操作指南</h3>
            <div class="panel-content">
              <p>• 点击区块查看详情</p>
              <p>• 鼠标拖拽旋转视角</p>
              <p>• 滚轮缩放地图</p>
            </div>
          </div>
        </div>
      </div>

      <!-- 右侧容器 -->
      <div class="right-panel">
        <div class="panel-container">
          <div class="panel-item" id="right-panel-1">
            <h3>区块详情</h3>
            <div class="panel-content">
              <div class="detail-item">
                <span class="detail-label">当前选中</span>
                <span class="detail-value">无</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">区块ID</span>
                <span class="detail-value">-</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">发展指数</span>
                <span class="detail-value">-</span>
              </div>
            </div>
          </div>
          <div class="panel-item" id="right-panel-2">
            <h3>实时数据</h3>
            <div class="panel-content">
              <div class="data-item">
                <span class="data-label">总人口</span>
                <span class="data-value">约500万</span>
              </div>
              <div class="data-item">
                <span class="data-label">总面积</span>
                <span class="data-value">约2万平方公里</span>
              </div>
              <div class="data-item">
                <span class="data-label">平均GDP</span>
                <span class="data-value">约3000万元</span>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- 中央地图容器 -->
      <div id="map-container"></div>

      <!-- 右下角操作按钮组 -->
      <div class="bottom-right-controls">
        <button class="control-btn" onclick="resetView()" title="重置视角">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <path d="M12 2V6L16 2L12 2Z" fill="currentColor" />
            <path d="M12 18V22L8 18H12Z" fill="currentColor" />
            <path d="M4.93 4.93L7.76 7.76L6.34 9.17L4.93 7.76C3.12 9.57 2 12.15 2 15C2 18.87 5.13 22 9 22C11.85 22 14.43 20.88 16.24 19.07L17.66 20.49C15.44 22.71 12.38 24 9 24C4.03 24 0 19.97 0 15C0 11.62 1.29 8.56 3.51 6.34L4.93 4.93Z" fill="currentColor" />
            <path d="M15 2C19.97 2 24 6.03 24 11C24 14.38 22.71 17.44 20.49 19.66L19.07 18.24C20.88 16.43 22 13.85 22 11C22 7.13 18.87 4 15 4C12.15 4 9.57 5.12 7.76 6.93L6.34 5.51C8.56 3.29 11.62 2 15 2Z" fill="currentColor" />
          </svg>
          <span>重置视角</span>
        </button>
        <button class="control-btn" onclick="toggleRotation()" title="旋转地图">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <path d="M12 2C17.52 2 22 6.48 22 12C22 17.52 17.52 22 12 22C6.48 22 2 17.52 2 12C2 6.48 6.48 2 12 2ZM12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20C16.42 20 20 16.42 20 12C20 7.58 16.42 4 12 4ZM12 6L16 10H13V14H11V10H8L12 6Z" fill="currentColor" />
          </svg>
          <span>旋转地图</span>
        </button>
        <button class="control-btn" onclick="refreshData()" title="刷新数据">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20C15.73 20 18.84 17.45 19.73 14H17.65C16.83 16.33 14.61 18 12 18C8.69 18 6 15.31 6 12C6 8.69 8.69 6 12 6C13.66 6 15.14 6.69 16.22 7.78L13 11H20V4L17.65 6.35Z" fill="currentColor" />
          </svg>
          <span>刷新数据</span>
        </button>
      </div>

      <!-- 调试菜单 -->
      <div id="debug-menu">
        <h3>调试信息</h3>
        <div id="debug-output">等待操作...</div>
      </div>
    </div>

    <!-- 子页面模态框 -->
    <div id="district-modal" class="modal-overlay">
      <div class="modal-backdrop"></div>
      <div class="modal-container">
        <div class="modal-header">
          <h2 class="modal-title" id="modal-title">地块详情</h2>
          <button class="modal-close" id="modal-close">&times;</button>
        </div>
        <div class="modal-content" id="modal-content">
          <!-- 动态内容将在这里加载 -->
        </div>
      </div>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  </body>
</html>
